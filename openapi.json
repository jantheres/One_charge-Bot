{"openapi":"3.1.0","info":{"title":"1Charge Chatbot","version":"0.1.0"},"paths":{"/api/auth/login":{"post":{"tags":["Authentication"],"summary":"User Login","description":"Authenticate a user via phone number.\n\n*   **phone**: Registered mobile number (e.g., '9876543211')\n\nReturns a short-lived **JWT Bearer Token** for authorized access to Chat and Agent APIs.","operationId":"login_api_auth_login_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginRequest"}}},"required":true},"responses":{"200":{"description":"JWT Access Token","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Token"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/chatbot/start":{"post":{"tags":["Chatbot"],"summary":"Start New Session","description":"Start a new Chatbot conversation.\n\n*   **Requires Auth**: Valid User Token.\n*   **Auto-Identity**: Automatically detects user from token, skipping 'What is your name?'.\n*   **Initial State**: Jumps directly to `AWAITING_LOCATION`.","operationId":"start_conversation_api_chatbot_start_post","responses":{"200":{"description":"New Session ID and Welcome Message","content":{"application/json":{"schema":{}}}}},"security":[{"HTTPBearer":[]}]}},"/api/chatbot/message":{"post":{"tags":["Chatbot"],"summary":"Send Message","description":"Process a user message in the active session.\n\n*   **session_id**: The active session ID from `/start`.\n*   **message**: The user's text input or coordinate string.\n*   **message_type**: 'text' (default) or 'gps' (for raw coordinates).\n\nReturns the Bot's next response, current state, and any interactive options.","operationId":"process_message_api_chatbot_message_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MessageRequest"}}},"required":true},"responses":{"200":{"description":"Bot Reply","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/api/agent/escalations":{"get":{"tags":["Agent Dashboard"],"summary":"Get Active Tickets","description":"Fetch all **Active** tickets (Requests & Escalations).\n\nIncludes tickets with status: `OPEN`, `IN_PROGRESS`, `DISPATCHED`, `ON_SITE`.\nDoes **NOT** include `RESOLVED` tickets (unless modified).","operationId":"get_escalations_api_agent_escalations_get","responses":{"200":{"description":"List of requests and escalations","content":{"application/json":{"schema":{}}}}},"security":[{"HTTPBearer":[]}]}},"/api/agent/ticket/{item_id}/status":{"patch":{"tags":["Agent Dashboard"],"summary":"Update Ticket Status","description":"Transition a ticket to a new status.\n\n*   **source**: Query param 'REQUEST' or 'ESCALATION' (default).\n*   **status**: One of `OPEN`, `IN_PROGRESS`, `DISPATCHED`, `ON_SITE`, `RESOLVED`, `CLOSED`.","operationId":"update_status_api_agent_ticket__item_id__status_patch","security":[{"HTTPBearer":[]}],"parameters":[{"name":"item_id","in":"path","required":true,"schema":{"type":"integer","title":"Item Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/StatusUpdate"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}}},"components":{"schemas":{"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"LoginRequest":{"properties":{"phone":{"type":"string","title":"Phone"}},"type":"object","required":["phone"],"title":"LoginRequest"},"MessageRequest":{"properties":{"session_id":{"type":"string","title":"Session Id"},"message":{"type":"string","title":"Message"},"message_type":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Message Type","default":"text"},"location":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Location"}},"type":"object","required":["session_id","message"],"title":"MessageRequest"},"StatusUpdate":{"properties":{"status":{"type":"string","title":"Status"}},"type":"object","required":["status"],"title":"StatusUpdate"},"Token":{"properties":{"access_token":{"type":"string","title":"Access Token"},"token_type":{"type":"string","title":"Token Type"}},"type":"object","required":["access_token","token_type"],"title":"Token"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}},"securitySchemes":{"HTTPBearer":{"type":"http","scheme":"bearer"}}}
